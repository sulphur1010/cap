.event_page
	.page
		/= render :partial => 'shared/share'
		- if is_admin?
			= link_to 'Edit', edit_admin_event_url(@event), :class => 'btn_edit'
		%h2
			= @event.title
		.event_header
			%table.full
				%tr
					%th Event Type
					%th Starts
					%th Ends
					%th Duration

				%tr
					%td
						- if @event.type
							/.event_type{ :class => "event_type_#{@event.type.to_s.downcase.gsub(" ", "_")}"}
							= @event.type									
					%td
						- if @event.start_date
							%span.event_start= "#{@event.formatted_start}"					
					%td
						- if @event.end_date
							%span.event_end= "#{@event.formatted_end}"
					%td
						- if @event.start_date && @event.end_date
							%span.event_duration= @event.duration_in_words
	.page
		.event_body= @event.body.html_safe rescue ""

	.page
		- if @event.location
			.location_box
				.event_location
					Main Location: 
				.event_location_name
					= @event.location.name
				.event_location_address
					= @event.location.address
		- if @event.chapter
			.host_box
				.event_chapter
					Hosted by:
				.event_chapter_name
					= @event.chapter.name 
		- if @event.director
			.director_box
				.event_director
					%b Program Contact: 
				= @event.director.full_name
				@
				%span.event_director_phone
					= @event.director.phone
				or
				%span.event_director_email
					%a{:href => "mailto:#{@event.director.email}"}= @event.director.email
		- unless @thanks
			- if @event.attendees.include?(current_user)
				- ae = AttendeesEvent.where(:attendee_id => current_user.id).where(:event_id => @event.id).first
				- if ae.payment_confirmation.nil? && !@event.free_event
					.payment_instructions
						%b YOU HAVE RSVP'd:
						%h1 
							Total:
							= number_to_currency(ae.total_cost)
						%br
						%strong Instructions:
						= @event.other_payment_type_instructions
				- if ae.payment_confirmation.nil?
					.unrsvp
						= link_to 'UnRSVP for this Event', unrsvp_event_url(@event), :method => :post
				- else
					%h6 You have RSVP'd for this event, if you need to un-register please notify the program contact.
			- else
				- if @event.spots_left > 0
					- if !user_signed_in?
						.rsvp_block
							.unrsvp= link_to "Create an Account on Capp-usa.org to Register for Events", new_user_registration_url
							.sign_in= link_to "Already signed up to capp-usa.org?  Login.", new_user_session_url
					= render :partial => 'rsvp_block'
		- else
			.pending
				= "Your registration is currently pending."
	%hr
	.page
		%b.inline
			%h4 Ideal for the:
		- @event.person_types.each do |person_type|
			-#= link_to person_type.name, person_type_path(person_type), :class => 'person_type_link'
			%span.person_type_link= person_type.name
	- if !@event.contemporary_issues.empty?
		%hr
		.page
			%h4.inline
				Contemporary Issues Covered:
			- @event.contemporary_issues.each do |issue|
				= link_to issue.title, contemporary_issue_path(issue), :class => 'contemporary_issue_link'	
	- if !@event.speakers.empty?
		%hr
		.page
			%h4 Speakers / Panelists:
			= render :partial => 'users/list', :object => @event.speakers
	- if !@event.celebrants.empty?
		%hr
		.page
			%h4 Celebrants:
			= render :partial => 'users/list', :object => @event.celebrants
	- if @teaser_event
		%hr
		.page
			%h4 Another Event:
			= render :partial => 'teaser', :object => @teaser_event
	- if is_admin?
		.page
			.attendee_list
				%h4 Add User
				= semantic_form_for [:admin, @event, AttendeesEvent.new] do |f|
					- users = User.order(:last_name).all.delete_if { |c| @event.attendees.include?(c) }
					= f.input :attendee, :collection => users
					= f.input :count
					= f.input :total_cost
					= f.actions
				%hr
				.right.link= link_to "Download Attendee List Spreadsheet", user_list_admin_event_path(@event)
				%h4 Attendees
				%table.event_attendees_table
					%tr
						%th Last Name
						%th First Name
						%th Email
						%th Spots
						%th Total
						%th Payment Type
						%th
					- @event.attendees_events.sort { |a,b| (a.attendee.last_name rescue '') <=> (b.attendee.last_name rescue '') }.each do |attendee_event|
						%tr
							%td= attendee_event.last_name
							%td= attendee_event.first_name
							%td= attendee_event.email
							%td= attendee_event.count
							%td= number_to_currency(attendee_event.total_cost)
							%td= attendee_event.payment_method
							%td= link_to "remove", admin_event_attendees_event_path(@event, attendee_event), :method => :delete, :confirm => "Are you sure?"
